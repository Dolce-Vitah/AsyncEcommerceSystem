# Третье большое домашнее задание по КПО

## Содержание
- [Инструкция к запуску](#инструкция-к-запуску)
- [Архитектура приложения](#архитектура-приложения)
- [Особенности реализации](#особенности-реализации)
- [Тесты](#тесты)
- [Frontend](#frontend)


## Инструкция к запуску

1. Скачиваем архив или клонируем репозиторий
2. Запускаем Docker Desktop
3. В терминале выполняем команду:
```
docker-compose build
```
4. После длительного ожидания выполняем команду:
```
docker-compose up -d
```

Миграции применяются автоматически, код для этого прописан в каждом сервисе, в файле Program.cs.


## Архитектура приложения
Приложение реализует асинхронное межсервисное взаимодействие и состоит из следующих сервисов:
1. **OrdersService** - сервис для создания заказов, просмотра статуса и списка заказов;
2. **PaymentsService** - сервис для создания счета (аккаунта), его пополнения и просмотра баланса;
3. **API Gateway** - шлюз для распределения запросов.

Также была реализована фронтенд-часть **ecommercefrontend** с использованием React, JS, CSS.


## Особенности реализации

Пробежимся по выполненным требованиям:

- Основной функционал реализован в каждом сервисе: возможность создавать счет и заказ, пополнять счет и просматривать баланс. Также можно просматривать все заказы конкретного пользователя. При просмотре статуса заказа стоит иметь в виду следующее: 0 - Pending, 1 - Paid, 2 - Failed.
- При предоставлении ID пользователя стоит помнить, что он имеет формат Guid. Например, 550e8400-e29b-41d4-a716-446655440000.
- Семантика exactly-once была реализована следующим образом: до обработки идентификатор входящего сообщения сохраняется в Inbox, обработка происходит в рамках одной транзакции. Если сообщение уже есть в Inbox, оно не обрабатывается повторно. Kafka-коммит происходит после успешной обработки.
- Паттерны Transactional Outbox/Inbox реализованы в файлах KafkaMessagePublisher.cs и KafkaConsumerFactory.cs.
- Также реализован Swagger в каждом сервисе. Для проверки работоспособности каждого сервиса к каждому его URL нужно добавить /swagger.


## Тесты

Для каждого сервиса реализован проект-тестер: OrdersService.Tests, PaymentsService.Tests и ApiGateway.Tests. Для проверки процента покрытия тестами нужно в каждом из этих проектов найти директорию **coveragereport** и открыть **index.html**.

Напоминание: требование на процент покрытия упал с 65 до 15 :)


## Frontend
Реализовано простое веб-приложение на React'е. Посмотреть можно по адресу http://localhost:3000 после запуска Docker.